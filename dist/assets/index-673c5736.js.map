{"version":3,"file":"index-673c5736.js","sources":["../../main.js"],"sourcesContent":["import './style.css';\n\n// Configuration and constants\nconst API_KEY = import.meta.env.VITE_API_KEY;\nconst LPIN = import.meta.env.VITE_LPIN;\nconst API_BASE_URL = 'https://api.latch.bio';\n\n// DOM Elements\nlet app;\nlet statusElement;\nlet debugOutput;\nlet unlockButton;\nlet autoCloseInput;\n\n// Initialize the application\ndocument.addEventListener('DOMContentLoaded', () => {\n  initializeApp();\n});\n\nfunction initializeApp() {\n  app = document.querySelector('#app');\n  renderUI();\n  \n  // Get DOM references after rendering\n  statusElement = document.querySelector('#status');\n  debugOutput = document.querySelector('#debug-output');\n  unlockButton = document.querySelector('#unlock-button');\n  autoCloseInput = document.querySelector('#auto-close-time');\n  \n  // Add event listeners\n  unlockButton.addEventListener('click', handleUnlockClick);\n  \n  // Log initialization\n  logMessage('Application initialized');\n  \n  // Check if environment variables are available\n  if (!API_KEY || !LPIN) {\n    logMessage('ERROR: API key or PIN not found in environment variables', true);\n    updateStatus('Configuration error. Check console for details.', 'error');\n    unlockButton.disabled = true;\n  } else {\n    logMessage('Configuration loaded successfully');\n  }\n}\n\nfunction renderUI() {\n  app.innerHTML = `\n    <div class=\"container\">\n      <h1>Door Lock Control</h1>\n      \n      <div class=\"control-panel\">\n        <div class=\"input-group\">\n          <label for=\"auto-close-time\">Auto-close after (seconds):</label>\n          <input type=\"number\" id=\"auto-close-time\" min=\"0\" max=\"300\" value=\"30\">\n        </div>\n        \n        <button id=\"unlock-button\" class=\"primary-btn\">Unlock Door</button>\n        \n        <div id=\"status\" class=\"status\"></div>\n      </div>\n      \n      <div class=\"debug-section\">\n        <h3>System Log</h3>\n        <div id=\"debug-output\" class=\"debug-output\"></div>\n      </div>\n    </div>\n  `;\n}\n\nasync function handleUnlockClick() {\n  const autoCloseTime = parseInt(autoCloseInput.value) || 0;\n  \n  // Disable button during operation\n  unlockButton.disabled = true;\n  updateStatus('Sending unlock command...', 'pending');\n  \n  try {\n    logMessage(`Attempting to unlock door with auto-close time: ${autoCloseTime}s`);\n    const result = await unlockDoor(autoCloseTime);\n    \n    if (result.success) {\n      updateStatus('Door unlocked successfully!', 'success');\n      logMessage('Door unlocked successfully');\n    } else {\n      updateStatus(`Failed to unlock: ${result.message}`, 'error');\n      logMessage(`Unlock failed: ${result.message}`, true);\n    }\n  } catch (error) {\n    updateStatus('Error communicating with door system', 'error');\n    logMessage(`Error: ${error.message}`, true);\n  } finally {\n    // Re-enable button\n    unlockButton.disabled = false;\n  }\n}\n\nasync function unlockDoor(autoCloseTime = 0) {\n  try {\n    logMessage('Preparing API request');\n    \n    const response = await fetch(`${API_BASE_URL}/door/unlock`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${API_KEY}`\n      },\n      body: JSON.stringify({\n        pin: LPIN,\n        auto_close_time: autoCloseTime\n      })\n    });\n    \n    const data = await response.json();\n    logMessage('API response received', false, data);\n    \n    if (!response.ok) {\n      return {\n        success: false,\n        message: data.message || `Server error: ${response.status}`\n      };\n    }\n    \n    return {\n      success: true,\n      data: data\n    };\n  } catch (error) {\n    logMessage(`API request failed: ${error.message}`, true);\n    throw error;\n  }\n}\n\nfunction updateStatus(message, type = '') {\n  if (!statusElement) return;\n  \n  statusElement.textContent = message;\n  statusElement.className = 'status';\n  \n  if (type) {\n    statusElement.classList.add(type);\n  }\n}\n\nfunction logMessage(message, isError = false, data = null) {\n  if (!debugOutput) return;\n  \n  const timestamp = new Date().toLocaleTimeString();\n  const logEntry = document.createElement('div');\n  logEntry.className = 'log-entry';\n  \n  const timestampSpan = document.createElement('span');\n  timestampSpan.className = 'timestamp';\n  timestampSpan.textContent = `[${timestamp}]`;\n  \n  logEntry.appendChild(timestampSpan);\n  logEntry.appendChild(document.createTextNode(` ${message}`));\n  \n  if (isError) {\n    logEntry.style.color = '#e74c3c';\n  }\n  \n  if (data) {\n    const pre = document.createElement('pre');\n    pre.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;\n    logEntry.appendChild(pre);\n  }\n  \n  debugOutput.appendChild(logEntry);\n  debugOutput.scrollTop = debugOutput.scrollHeight;\n  \n  // Also log to console for debugging\n  if (isError) {\n    console.error(message, data || '');\n  } else {\n    console.log(message, data || '');\n  }\n}\n"],"names":["API_KEY","LPIN","API_BASE_URL","app","statusElement","debugOutput","unlockButton","autoCloseInput","async","handleUnlockClick","autoCloseTime","parseInt","value","disabled","updateStatus","logMessage","result","response","fetch","method","headers","Authorization","body","JSON","stringify","pin","auto_close_time","data","json","ok","success","message","status","error","unlockDoor","type","textContent","className","classList","add","isError","timestamp","Date","toLocaleTimeString","logEntry","document","createElement","timestampSpan","appendChild","createTextNode","style","color","pre","scrollTop","scrollHeight","console","log","addEventListener","querySelector","innerHTML"],"mappings":"usBAGMA,EAAU,mEACVC,EAAO,aACPC,EAAe,wBAGrB,IAAIC,EACAC,EACAC,EACAC,EACAC,EAyDJC,eAAeC,IACb,MAAMC,EAAgBC,SAASJ,EAAeK,QAAU,EAGxDN,EAAaO,UAAW,EACxBC,EAAa,4BAA6B,WAEtC,IACSC,EAAA,mDAAmDL,MACxD,MAAAM,QAkBVR,eAA0BE,EAAgB,GACpC,IACFK,EAAW,yBAEX,MAAME,QAAiBC,MAAM,GAAGhB,gBAA4B,CAC1DiB,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChBC,cAAiB,UAAUrB,KAE7BsB,KAAMC,KAAKC,UAAU,CACnBC,IAAKxB,EACLyB,gBAAiBhB,MAIfiB,QAAaV,EAASW,OAGxB,OAFOb,EAAA,yBAAyB,EAAOY,GAEtCV,EAASY,GAOP,CACLC,SAAS,EACTH,QARO,CACLG,SAAS,EACTC,QAASJ,EAAKI,SAAW,iBAAiBd,EAASe,SAQxD,OAAQC,GAED,MADNlB,EAAW,uBAAuBkB,EAAMF,WAAW,GAC7CE,CACP,CACH,CApDyBC,CAAWxB,GAE5BM,EAAOc,SACThB,EAAa,8BAA+B,WAC5CC,EAAW,gCAEXD,EAAa,qBAAqBE,EAAOe,UAAW,SACpDhB,EAAW,kBAAkBC,EAAOe,WAAW,GAElD,OAAQE,GACPnB,EAAa,uCAAwC,SACrDC,EAAW,UAAUkB,EAAMF,WAAW,EAC1C,CAAY,QAERzB,EAAaO,UAAW,CACzB,CACH,CAsCA,SAASC,EAAaiB,EAASI,EAAO,IAC/B/B,IAELA,EAAcgC,YAAcL,EAC5B3B,EAAciC,UAAY,SAEtBF,GACY/B,EAAAkC,UAAUC,IAAIJ,GAEhC,CAEA,SAASpB,EAAWgB,EAASS,GAAU,EAAOb,EAAO,MACnD,IAAKtB,EAAa,OAElB,MAAMoC,GAAY,IAAIC,MAAOC,qBACvBC,EAAWC,SAASC,cAAc,OACxCF,EAASP,UAAY,YAEf,MAAAU,EAAgBF,SAASC,cAAc,QAW7C,GAVAC,EAAcV,UAAY,YACZU,EAAAX,YAAc,IAAIK,KAEhCG,EAASI,YAAYD,GACrBH,EAASI,YAAYH,SAASI,eAAe,IAAIlB,MAE7CS,IACFI,EAASM,MAAMC,MAAQ,WAGrBxB,EAAM,CACF,MAAAyB,EAAMP,SAASC,cAAc,OAC/BM,EAAAhB,YAA8B,iBAATT,EAAoBJ,KAAKC,UAAUG,EAAM,KAAM,GAAKA,EAC7EiB,EAASI,YAAYI,EACtB,CAED/C,EAAY2C,YAAYJ,GACxBvC,EAAYgD,UAAYhD,EAAYiD,aAGhCd,EACMe,QAAAtB,MAAMF,EAASJ,GAAQ,IAEvB4B,QAAAC,IAAIzB,EAASJ,GAAQ,GAEjC,CAjKAkB,SAASY,iBAAiB,oBAAoB,KAKtCtD,EAAA0C,SAASa,cAAc,QA0B7BvD,EAAIwD,UAAY,goBAtBAvD,EAAAyC,SAASa,cAAc,WACzBrD,EAAAwC,SAASa,cAAc,iBACtBpD,EAAAuC,SAASa,cAAc,kBACrBnD,EAAAsC,SAASa,cAAc,oBAG3BpD,EAAAmD,iBAAiB,QAAShD,GAGvCM,EAAW,2BAQTA,EAAW"}